# 共识算法：区块链技术的根源

本文来自[101blockchains](https://101blockchains.com)，作者是Hasib Anwar。而本文是其[Consensus Algorithms: The Root Of The Blockchain Technology](https://101blockchains.com/consensus-algorithms-blockchain/)的中文翻译，翻译不到之处还请指正。也感谢Hasib Anwar的文章，非常值得一读。


## 引言

每一天，我们都可以看到新的区块链技术出现在我们生活当中。无论我们如何努力想要掌握最新的技术，却总是应接不暇。有没有想过所有这些区块链技术的根源是什么？好吧，共识算法是这些革命性技术的首要根源。

共识算法使得所有这些区块链共识序列不同于其他的算法。在同一个地方，区块链网络便利了成千上百万的人们。那么，为什么它们永远不会相互干预或者相互存在呢？

答案就在区块链网络的架构里。该架构设计巧妙，并且共识算法在该架构的最核心位置。

如果你真的想知道区块链共识序列是如何工作的，那么你必须要比你所想的要更为深入。这也就是为什么我将在本指南中涵盖已知的所有共识算法的内容。那么，让我们继续吧！


## 目录

- [第一章：什么是共识算法？](#第一章：什么是共识算法？)

- [第二章：拜占庭容错算法的问题](#第二章：拜占庭容错算法的问题)

- [第三章：我们为什么需要共识算法？](#第三章：我们为什么需要共识算法？)

- [第四章：区块链：分布式网络中有组织的数据的框架](#第四章：区块链：分布式网络中有组织的数据的框架)

- [第五章：共识算法：网络的灵魂](#第五章：共识算法：网络的灵魂)

- [第六章：不同类型的共识算法](#第六章：不同类型的共识算法)
        
- [第七章：其他类型的共识算法](#第七章：其他类型的共识算法)

- [第八章：结论](#第八章：结论)


## 第一章：什么是共识算法？

技术定义可能是这样的：

共识算法是一个组的决策过程，组中的个体构建并支持最适合组中其余个体的决策。这是一种解决方案，个体需要支持多数决策，无论它们是否喜欢。

简单来讲，它就是一种组内决定的方法。我举一个例子你就更明白了。想象一个有10个人的小组，想要就项目于他们个人的利益做一个决定。每个人都可以提出一个观点，但是大多数将同意其中的一个最为有用的想法，而其他人必须接受这个决定，无论他们喜欢与否。

现在想象下这样的一个决定对于1000个人来说的情况。难道这不会使得决策变得更加艰难吗？

共识算法不仅仅是赞同大多数的投票，而且还要同意对全体都有利的那个。因此，它总会在网络中取胜。

区块链共识模型是在互联网世界里创造公平和公正的一种方法。用于这种协定的共识系统我们称其为共识定理。

这些区块链共识模型由一些特殊的对象组成，例如：

- 达成协议：该机制尽可能多的收集组内的所有协议。

- 协作：小组成员都希望达成更好的协议，以此产生对整个小组更好的利益。

- 合作：每个个体都将团结一致，而把自己的利益放在一边。

- 平等权利：每个参与者在投票中都有相同的价值，这意味着每个人的投票都很重要。

- 参与：每个在网络中的个体都需要参与投票。不会有人将被遗漏，更不会有人可以不投票就留在外面。

- 活动：小组中的每个成员都同样活跃，没有哪个成员将负有更多的责任。

**Different Types of Consensus Algorithms Infographic**

![Different Types of Consensus Algorithms Infographic](https://github.com/i0Ek3/YGP/blob/master/image/Different_Consensus_Algorithms.png)


## 第二章：拜占庭容错算法的问题

拜占庭容错是一种具有特定故障时间的系统，它被称为拜占庭将军问题，你可以通过分布式计算机系统来更好地体验这种情形。很多时候，共识系统可能会出现故障。

这些组件将进一步解决冲突的信息，只要所有要素协调一致，共识系统才能成功地运行。然而，如果系统中的一个组件出现故障，则整个系统将会发生故障。

故障成分总是会导致拜占庭容错系统不一致，这也就是为什么它对于使用共识算法的去中心化网络而言不是理想的原因了。

专家们称它为“拜占庭将军问题”，仍然疑惑吗？

让我用一个共识的例子来讲清楚它。

想象一下这里有一组将军，他们每个人都拥有一支拜占庭军队。他们准备去攻占一个城邦，并且他们需要决定如何展开攻击。

你可能认为这很轻松。然而，却有一点点困难。将军们只可以通过信使来沟通，并且这里有些叛徒将军试图破坏整个攻击。

他们可以通过信使来发送不可靠消息，或者信使也可以成为叛徒。

信使也可以通过传送错误的消息来故意破坏。

这就是为什么这个问题需要被谨慎处理的原因了。首先，无论如何我们都需要将军们互相达成决定。第二，确保即使是最少的叛徒数量也不会使的整个任务失败。

这对你来说可能相当简单，然而，并不是这样。根据研究，在有n个叛徒的将军中，需要有3n+1个将军是诚实的。也就是说，需要有4名将军来对应一个叛徒，这的确有些棘手。



## 第三章：我们为什么需要共识算法？

拜占庭主要的问题是达成协议。如果出现单点故障，则所有节点无法达成协议或者获得一个更高的难度值。

另一方面，共识算法并不真正面对这类问题。他们的主要目标是以任何方式达到特定的目标。区块链共识算法模型是比拜占庭更可信任和更具容错性的。

这就是为什么在分布式系统中会有矛盾的结果；而用一致性算法便是为了有一个更好的输出。



## 第四章：区块链：分布式网络中有组织的数据的框架

现在让我们来窥探一下区块链技术，以便更好地了解整个网络。

* 它是组织数据库的一种新方法。
* 它可以存储根据网络变化的所有内容。
* 所有数据就像物品一样整齐的排列在块中。

然而，你却无法在区块链本身上看到任何去中心化。这是因为区块链并不提供去中心化的环境。这就是我们需要共识算法来使得系统变得去中心化的原因了。

所以，区块链技术只允许你创建一个不同的结构化数据库，但是它并不执行去中心化进程。这就是为什么区块链被认为是整个去中心化网络里的骨架了。

 
## 第五章：共识算法：网络的灵魂

方法是真的很简单。这些区块链共识模型仅仅是达成协议的方式。但是，如果没有共同的共识算法，就不可能有任何的去中心化系统。

它甚至不需要在意节点之间是否会彼此信任。他们必须遵守确定的原则并且来达成集体协议。为此，你必须检查所有的共识算法。

目前，我们还没有发现任何适用于每种区块链技术的特定区块链算法。让我们见识一下不同的区块链共识算法，以便更好地了解整个情况。


## 第六章：不同类型的共识算法

原文列出的共识算法：

* PoW--工作量证明
* PoS--股权证明
* DPoS--委托股权证明 [参考](https://github.com/i0Ek3/YGP/blob/master/paper/readed/058.pdf)
* LPoS--租赁股权证明
* PoET--时间消逝证明 [参考](https://github.com/i0Ek3/YGP/blob/master/paper/readed/062.pdf)
* PBFT--实用拜占庭容错
* SBFT--简单拜占庭容错
* DBFT--委托拜占庭容错
* DAG--有向无环图
* PoA--活动证明 [参考](https://github.com/i0Ek3/YGP/blob/master/paper/readed/064.pdf)
* PoI--重要性证明
* PoCapcity--容量证明
* PoB--出生证明？
* PoWeight--权值证明

笔者列出的共识算法：

* Bitcoin-NG
* Casper
* Tendermint
* Raft [动画演示](http://thesecretlivesofdata.com/raft/)
* Paxos
* PoL--幸运证明 [参考](https://github.com/i0Ek3/YGP/blob/master/paper/readed/030.pdf)
* PoP--可能性证明 [参考](https://github.com/i0Ek3/YGP/blob/master/paper/readed/035.pdf)
* PoV--投票证明 [参考](https://github.com/i0Ek3/YGP/blob/master/paper/readed/052.pdf)
* PoT--信任证明 [参考](https://github.com/i0Ek3/YGP/blob/master/paper/readed/056.pdf)
* PoContribution--贡献证明 [参考](https://github.com/i0Ek3/YGP/blob/master/paper/readed/057.pdf)
        

### Proof of Work

工作量证明是第一个在区块链网络中被引用的区块链共识算法。许多区块链技术使用该区块链共识模型来确认他们的所有交易并为网络链生成相关的区块。

去中心化的账本系统在区块中收集所有相关的信息。但是，需要特别关注事务块。

这个责任落在称为矿工的单个节点上，而矿工所维护的这一过程我们称之为挖矿。该技术背后的核心原则是为了解决复杂的数学难题并给出结果。
	
你可能在想是什么样的数学难题呢？

这些数学难题需要大量的计算机算力才能开始。例如，哈希函数或者已知如何在没有输入的情况下找到输出。另一个是整数分解，它也涵盖了旅游难题。

当服务器感觉被DDoS攻击并且发现共识系统需要的大量计算时，便会发生这样的情况。这就是矿工需要做的。整个数学方程问题的答案我们称之为哈希。

但是工作量证明有一定的限制。网络似乎增长了很多，因此，它需要大量的计算能力。该过程使得系统变得缓慢。

![PoW](https://github.com/i0Ek3/YGP/blob/master/image/PoW.png)

#### 为什么系统会变得如此敏感呢？

区块链共识序列主要依赖准确的计算数据和信息。但是，系统的速度却跟不上。如果问题变得太过复杂，则生成块需要花费大量的时间。

交易延迟了，所有的工作流便会暂停。如果在特定时间内无法解决块生成的问题，那么生成一个区块将变得困难。

但是，对一个系统来说，若是问题变得太简单，它将更容易受到DDoS攻击。此外，需要进一步精确地检查解决方案，因为并不是所有的节点都可以检查可能的错误。

如果他们可以，网络将缺乏最为重要的特质--透明度。


#### 工作量证明机制是如何在区块链网络上实现的？   

首先，矿工将会解决所有的谜题，之后将创建新的区块并在此之后来确认交易。无法说出谜题有多么复杂。

它在很大程度上取决于最大用户数，最小电流功率和网络总负载。

新的区块带有哈希函数，并且每个区块都包含着前一个区块的哈希函数。通过这种方式，网络添加了额外的防护层并防止任何类型的侵犯。一旦矿工解决了谜题，一个新的区块将被创建，交易也将被确认。


#### 区块链中在哪里确切地用到了工作量证明共识算法？

最流行的便是比特币了。比特币在任何其他加密货币之前便引用了这种共识算法。区块链共识模型允许基于网络的整体功能对谜题的难度进行任何类型的更改。

创建新的区块大约需要花费10分钟。类似莱特币的其他加密货币也提供了同样的机制。

另一个区块链算法用户，以太坊，在平台上的近3-4个大型项目中使用了工作量证明。然而，以太坊已经转向了股权证明。


#### 为什么区块链技术首先使用工作量证明？

你一定会好奇为什么不同的区块链技术开始使用工作量证明。

这是因为工作量证明提供DDoS防护并降低了整个股权开采。该区块链算法为黑客们提供了相当大的难度。该系统需要大量的算力和效率。

这也是黑客入侵区块链共识模型的原因所在了，但是它的代价很高，可能需要花费较长的时间和复杂度。

另一方面，没有矿工可以决定整个网络，那是因为决策并不依赖金钱的数量。而是依赖你有多少算力可以形成新的区块。


#### PoW共识算法的主要问题是什么？

不是所有的共识算法都是完美的；PoW也是不完美的，它有很多好处也有很多的缺陷。让我们来看看系统中的主要缺陷是什么。

* **巨大的能量消耗**

区块链网络包含了成千上万的哈希常用的微芯片，这个过程需要大量的电力。

目前比特币每秒可以提供200亿个哈希值。网络上的矿工使用一些特殊设计的微芯片进行哈希计算。该过程允许网络添加防护层来免受僵尸网络的攻击。

区块链网络的安全等级是基于需要大量能量的PoW共识机制，并且是密集的。巨大的消耗成为现实世界的一个问题，系统中的矿工需要承受巨大的电力消耗成本。

而这个问题的最好的解决办法便是廉价的能源。


* **矿工集中化**

随着能源问题，PoW将选择更便宜的电力解决方案。然而，主要的问题是如果比特币矿工制造商不断增加。在一定时间内，制造商可能变得更加耗电并试图在挖矿系统中创建新的规则。

该解决方案在去中心化的网络中将变得集中化。这就是区块链算法面临的另一个严峻问题的原因了。


#### 51%算力攻击为何物？

让我来解释清楚51%攻击真正的含义。该攻击意味着攻击者可能会控制大部分用户并且占有大量的挖矿能源。在这个场景中，攻击者将有足够的能源来控制网络中的一切。

他们可以阻止其他人生成区块。攻击者也可以接受基于他们把戏的奖励。

让我来举一个共识的例子。

想象一下这样的一个场景：爱丽丝通过区块链网络给鲍勃转账了一些加密货币。但是爱丽丝受到了攻击，而鲍勃并没有。交易被取代，但是攻击者并不会通过在链中启动分叉来转移任何金额的资金。

另外一种情况是，矿工将加入其中一个分支。他们将主要的算力结合到这些区块上。这就是为什么其他寿命较短的区块被拒绝的原因。最后，鲍勃并没有收到钱。

但是，这并不是有利可图的解决办法。因为这需要很大的挖矿能源，并且如果事件被曝光后，用户将永久地离开网络，而交易成本将会下降。


### PoS

#### 什么是PoS？

PoS是一种可以解决PoW算法主要缺陷的区块链共识算法。在该算法中，每个区块在加入区块链账本中之前会验证区块。矿工可以用它们金币的股权来加入挖矿进程。

PoS是一种新的概念，每个个体可以基于它们所拥有的币进行挖矿或者验证区块。因此，在这个场景中，你有越多的金币，你的机会也就越多。


#### 它是如何工作的？

在这个共识算法中，矿工可以获得之前地选择。

尽管整个过程是随机的，但也并不是每个矿工可以参与赌注。网络中所有的矿工随机地被选择。如有你的钱包里之前有存储一定数量的金币，那么你将有资格成为网络中的一个节点。

在成为一个节点之后，如果你想要有资格成为一名矿工，你将需要存入一定数目的金币，在那之后会有一个投票系统来选择验证器。当这些事情全部完成后，矿工将获得特定钱包赌注所需的最低金额。

该过程相当的简单。将根据钱包与硬币数量成比例地创建新的区块。例如，如果你拥有10%的金币，那么你可以挖出10%的新区块。

有很多区块链技术中应用了PoS共识算法。但是，对于挖掘一个新的区块来说，所有的共识算法的工作方式都是一样的，即每个矿工将会获得区块奖励以及交易费用的一部分。

![PoS](https://github.com/i0Ek3/YGP/blob/master/image/PoS.png)


#### 在PoS矿池中发生了什么？

有许多其他方式来参与赌注。如果赌注的数量非常大，那么你可以加入一个矿池并通过此来挣取利润。有两种方式可以做到。

首先，你可以把你的金币贷款给另一个已经加入矿池的用户，之后他可以与你分享利润。但是，你需要找到一个可信的人。

另一种方式是你自己加入到矿池中去。在这种方式下，参与该特定的矿池的每个人都将基于股权的数量来划分利润。


#### PoS：有什么好处？

首先，这种类型的共识算法不需要任何大量的硬件备份。你只需要有一个功能强大的计算机系统和一个稳定的网络即可。任何在网络上拥有足够金币的人都可以验证交易。

如果一个人投资于网络，它将不会像其他投资一样随着时间而贬值。唯一会影响利润的是价格浮动。PoS共识算法较PoW而言更为节能。它甚至不需要太多的电力消耗。

它也减少了51%攻击的威胁。

尽管PoS看起来比PoW更有利可图，但它仍然有非常严重的缺点。系统中主要的缺陷是永远不可能完全去中心化。

这是因为只有少数节点参与了网络上的赌注，拥有最多金币的个体最终会控制大部分系统。

![PoW VS PoS](https://github.com/i0Ek3/YGP/blob/master/image/PoW-vs-Pos-Simply-Explained.png?1538298537503)

#### 利用股权证明作为区块链技术基础的流行加密货币

##### PIVX

##### NavCoin

##### Stratis


### 区块链算法：委托股权证明共识

#### 证人验证所有签名

#### 选举代表中的特殊参数变更

#### 改变典型的规则

#### 双花攻击的风险

#### The Transactions Are Done As Proof of Stake

#### 谁在使用DPoS？


### LPoS

### PoET

#### 因特尔SGX系统

#### 信任代码

##### 加入区块链网络

##### 参与彩票系统


### PBFT

#### PBFT共识算法的好处

* 无需确认
* 减少能源

#### 系统的缺陷

* 沟通差距
* 女巫攻击


### SBFT

#### 简化拜占庭容错的不同阶段

#### 安全和隐私

* 一次性使用地址
* 零知识验证
* 元数据加密


### dBFT

#### 拜占庭将军问题的缺点！

#### 四个威胁！

#### dBFT是如何改变场景的？

#### 发言人和代表们！

#### 不诚实的发言人们

#### 不诚实的代表们


### DAG(Directed Acyclic Graphs)

#### DAG的基本概念

* 没有双花攻击
* 更少的宽度
* 更快更聪明
* 有利于较小的交易

        
## 第七章：其他类型的共识算法

### Proof of Activity

#### PoA是如何工作的？

#### PoA的影响

### Proof of Importance

#### 显着的重要性证明特征

* Vesting
* 合伙交易
* 评分系统


### Proof of Capacity

#### 容量证明机制是如何工作的？

#### 容量证明的利和弊


### Proof of Burn

#### The Eater Address

#### 燃烧证明的利与弊


### Proof of Weight


#### **各个共识算法之间的比较**


| Consensus Algorithms | Blockchain Platform | Launched Since | Programming Languages | Smart Contract |
| --- | --- | --- | --- | --- |
| PoW | df | sdf | dfs  | sdf |
| PoS | --- | --- | --- | --- |
| DPoS | --- | --- | --- | --- |
| LPoS | --- | --- | --- | --- |
| PoET | --- | --- | --- | --- |
| PBFT | --- | --- | --- | --- |
| SBFT | --- | --- | --- | --- |
| DBFT | --- | --- | --- | --- |
| DAG | --- | --- | --- | --- |
| PoA | --- | --- | --- | --- |
| PoI | --- | --- | --- | --- |
| PoC | --- | --- | --- | --- |
| PoB | --- | --- | --- | --- |
| PoWeight | --- | --- | --- | --- |


## 第八章：结论

正是共识算法使得区块链网络的本质变得如此通用。是的，没有一个共识算法可以被区块链称之为是完美的。但这就是我们猜测的技术之美--不断变化的改善。

如果这些共识算法没有出现，我们可能仍然依赖着PoW共识机制，无论你是否喜欢，PoW都会威胁到区块链的去中心化和分布性。

区块链技术的整个想法便是为了去中心化和对抗专制，现在正是该普通人制止腐败和错误系统的时候了。

我们迫不及待地等待更好的共识算法，这些算法将改变我们的生活，共创美好的明天。









